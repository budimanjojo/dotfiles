{{ if (eq .chezmoi.osRelease.id "arch") -}}
#!/bin/bash

set -eufo pipefail

packages=(
    fish
    neovim
    tmux
    curl
    python-pynvim
    git
    fd
    bat
    ripgrep
    thefuck
    npm
    fzf
    starship
    zoxide
    age
    exa
    unzip
)

aur_packages=()

{{   if (not .headless) -}}
packages+=(
    alacritty
    go
)
{{   end -}}

{{   if .i3wm -}}
packages+=(
    i3-gaps
    i3lock
    py3status
    rofi
    dunst
    conky
    xfce4-panel
)
{{   end -}}

{{   if .swaywm -}}
packages+=(
    sway
    swayidle
    rofi
    waybar
    dunst
)

aur_packages+=(
    nwg-dock
)

{{   end -}}

{{   if ne .chezmoi.username "root" -}}
sudo pacman -Syu --noconfirm
{{   else -}}
pacman -Syu --noconfirm
{{   end -}}

for package in ${packages[@]}; do
    if [ "$(pacman -Qq $package 2> /dev/null)" != $package ]; then
{{-   if ne .chezmoi.username "root" }}
        sudo pacman -S --noconfirm $package
{{-   else }}
        pacman -S --noconfirm $package
{{-   end }}
    fi
done

## Install yay
if [ ! $(command -v yay) ]; then
{{-   if ne .chezmoi.username "root" }}
    sudo pacman -S --needed --noconfirm git base-devel
{{-   else}}
    pacman -S --needed --noconfirm git base-devel
{{-   end }}
    git clone https://aur.archlinux.org/yay.git /tmp/yay
    cd /tmp/yay
    makepkg -si --noconfirm
    rm -rf /tmp/yay
fi

for aur_package in ${aur_packages[@]}; do
    if [ $(pacman -Qq $aur_package 2> /dev/null) != $aur_package ]; then
    yay -S --noconfirm $aur_package
    fi
done

{{ end -}}
